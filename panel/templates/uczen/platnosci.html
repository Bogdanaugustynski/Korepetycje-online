{% load static %}
<!DOCTYPE html><html lang="pl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Płatność za zajęcia — PolubiszTo.pl</title>
<style>
:root{--brand:#0b74ff;--ink:#0b1320;--muted:#5b6777;--bg:#f7f9fe;--line:#e6edff;--ok:#16a34a;--radius:16px;--maxw:1100px}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:var(--maxw);margin:32px auto;padding:0 16px}
.card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 2px 10px rgba(0,0,0,.04)}
.card-h{padding:16px 18px;border-bottom:1px solid var(--line);font-weight:700}
.card-b{padding:18px}
.grid{display:grid;gap:16px} @media (min-width:900px){.grid-2{grid-template-columns:1.2fr .8fr}}
.sumrow{display:flex;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px dashed var(--line)}
.sumrow:last-child{border-bottom:0}
.price{font-size:22px;font-weight:800}
.muted{color:var(--muted)} .notice{padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fcfdff}
.btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn-ghost{background:#fff;border:1px solid var(--line)}
.copy{cursor:pointer}
</style>
</head><body>

{% include "partials/brand.html" %}
<div class="wrap">
  <div class="card">
    <div class="card-h">Podsumowanie rezerwacji</div>
    <div class="card-b">
      <div class="sumrow"><span>Uczeń</span><strong>{{ request.user.get_full_name|default:request.user.username }}</strong></div>
      <div class="sumrow"><span>Nauczyciel</span><strong>{{ rezerwacja.nauczyciel.get_full_name|default:rezerwacja.nauczyciel.username }}</strong></div>
      <div class="sumrow"><span>Przedmiot</span><strong>{{ rezerwacja.przedmiot|default:"—" }}</strong></div>
      <div class="sumrow"><span>Poziom</span><strong>{{ rezerwacja.poziom|default:rezerwacja.poziom_nauki|default:"—" }}</strong></div>
      <div class="sumrow"><span>Termin</span><strong>{{ rezerwacja.termin|date:"Y-m-d H:i" }}</strong></div>
      <div class="sumrow"><span>Temat</span><strong>{{ rezerwacja.temat|default:"—" }}</strong></div>
      <div class="sumrow"><span>Do zapłaty</span><strong class="price">{{ kwota|floatformat:2 }} zł</strong></div>
      <div class="notice">Lekcja odbędzie się po zaksięgowaniu wpłaty i ręcznej akceptacji przez księgowość.</div>
    </div>
  </div>

  <div class="grid grid-2" style="margin-top:16px">
    <div class="card">
      <div class="card-h">Płatność BLIK — instrukcja</div>
      <div class="card-b">
        <div class="sumrow"><span>Kwota</span><strong>{{ kwota|floatformat:2 }} zł</strong></div>
        <div class="sumrow"><span>Numer telefonu (BLIK)</span><strong id="telblik">{{ ustawienia.numer_telefonu }}</strong></div>
        <div class="sumrow"><span>Tytuł</span><strong id="tytul_blik">Zajęcia {{ rezerwacja.id }} — {{ request.user.username }}</strong></div>
        <div class="notice">Zapłać BLIK na powyższy <b>numer telefonu</b> z podanym <b>tytułem</b>. Po zaksięgowaniu i ręcznej akceptacji status zmieni się na <b>opłacona</b>.</div>
        <div style="margin-top:12px">
          <button class="btn btn-ghost copy" data-copy="#telblik" type="button">Kopiuj numer BLIK</button>
          <button class="btn btn-ghost copy" data-copy="#tytul_blik" type="button">Kopiuj tytuł</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-h">Przelew na konto — instrukcja</div>
      <div class="card-b">
        <div class="sumrow"><span>Kwota</span><strong>{{ kwota|floatformat:2 }} zł</strong></div>
        <div class="sumrow"><span>Numer konta</span><strong id="nrkonta">{{ ustawienia.numer_konta }}</strong></div>
        <div class="sumrow"><span>Tytuł</span><strong id="tytul_przelew">Zajęcia {{ rezerwacja.id }} — {{ request.user.username }}</strong></div>
        <div class="notice">Wykonaj zwykły przelew bankowy. Po zaksięgowaniu i ręcznej akceptacji rezerwacja otrzyma status <b>opłacona</b>.</div>
        <div style="margin-top:12px">
          <button class="btn btn-ghost copy" data-copy="#nrkonta" type="button">Kopiuj numer konta</button>
          <button class="btn btn-ghost copy" data-copy="#tytul_przelew" type="button">Kopiuj tytuł</button>
        </div>

        <!-- UPLOAD POTWIERDZENIA (tylko wysyłka; uczeń NIE widzi linków) -->
        <hr style="border:0;border-top:1px solid var(--line);margin:16px 0">
        <div class="section-title" style="font-weight:700;margin-bottom:8px">Prześlij potwierdzenie przelewu (opcjonalnie)</div>
        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <input type="hidden" name="akcja" value="upload_potwierdzenie">
          <div style="display:grid; gap:10px; max-width:420px">
            <input type="file" name="potwierdzenie" accept=".pdf,.jpg,.jpeg,.png,.webp,.heic" required>
            <input type="text" name="note" placeholder="Krótki opis (opcjonalnie)" maxlength="255">
            <button class="btn btn-ghost" type="submit">Wyślij potwierdzenie</button>
            <div class="muted">Dozwolone: PDF/JPG/PNG/WEBP/HEIC, maks. 10 MB.</div>
          </div>
        </form>

        {% if messages %}
          <div style="margin-top:10px">
            {% for m in messages %}<div class="muted">{{ m }}</div>{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div style="margin-top:16px">
    <a class="btn btn-ghost" href="{% url 'platnosci_lista' %}">Wróć do listy płatności</a>
  </div>
</div>

<script>
  document.querySelectorAll('.copy').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const sel = btn.getAttribute('data-copy');
      const el = document.querySelector(sel); if(!el) return;
      const text = el.textContent.trim();
      navigator.clipboard.writeText(text).then(()=>{
        const old = btn.textContent; btn.textContent='Skopiowano ✓';
        setTimeout(()=>btn.textContent=old,1200);
      });
    });
  });
</script>
</body></html>
