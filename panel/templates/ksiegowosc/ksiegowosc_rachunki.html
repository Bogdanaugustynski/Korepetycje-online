{% load static %}
{% include "partials/brand.html" %}
<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ksiƒôgowo≈õƒá ‚Äî Rachunki</title>
<style>
  :root{--brand:#0b74ff;--brand-700:#095cd1;--ink:#0b1320;--muted:#5b6777;--line:#e6edff;--bg:#f7f9fe;--card:#fff;--shadow:0 12px 36px rgba(11,116,255,.12);--radius:14px;--maxw:1200px}
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  .wrap{max-width:var(--maxw);margin:24px auto;padding:0 16px}
  h1{font-size:clamp(20px,4vw,28px);margin:10px 4px}
  .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:10px 4px}
  .toolbar input[type="month"]{padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font:inherit}
  .btn{display:inline-flex;align-items:center;gap:8px;border:0;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600}
  .btn-primary{background:var(--brand);color:#fff}.btn-primary:hover{background:var(--brand-700)}
  .btn-outline{background:#fff;color:var(--brand);border:1px solid var(--brand)}
  .summary{display:flex;gap:12px;flex-wrap:wrap;margin:10px 4px}
  .pill{background:#f7fbff;border:1px solid var(--line);padding:10px 12px;border-radius:12px}
  .table-wrap{overflow:auto;display:block}
  table{width:100%;border-collapse:collapse;background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
  th,td{padding:12px 10px;border-bottom:1px solid var(--line);text-align:left}
  th{color:var(--muted);font-size:14px} td{font-size:15px}
  .mono{font-variant-numeric:tabular-nums;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .status{font-size:12px;border-radius:999px;padding:4px 8px;display:inline-block}
  .paid{background:#e8fff3;color:#0b8f4d;border:1px solid #b7f0cf}
  .pending{background:#fff8e6;color:#9a6b00;border:1px solid #fde1a6}
  .failed{background:#ffe9e9;color:#b01313;border:1px solid #ffbcbc}
  .tiles{display:none;grid-template-columns:1fr;gap:12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;display:flex;flex-direction:column;gap:8px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .nr{font-weight:800}
  .muted{color:var(--muted);font-size:13px}
  @media(max-width:767px){ .table-wrap{display:none} .tiles{display:grid} }
</style>
</head>
<body>
<div class="wrap">
  <h1>üßæ Rachunki ‚Äî Ksiƒôgowo≈õƒá</h1>

  <form method="get" class="toolbar">
    <input type="month" name="month" value="{{ month_value }}">
    <button class="btn btn-primary" type="submit">Zastosuj filtr</button>
    <a class="btn btn-outline" href="{% url 'accounting_invoices_export_csv' %}?month={{ month_value }}">‚¨áÔ∏è Eksport CSV</a>
  </form>

  <div class="summary">
    <div class="pill">Liczba rachunk√≥w: <strong>{{ sum_count }}</strong></div>
    <div class="pill">Suma brutto: <strong>{{ sum_total_pln }}</strong></div>
    <div class="pill">Op≈Çacone: <strong>{{ sum_paid }}</strong></div>
  </div>

  <!-- Desktop -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Nr</th><th>Data</th><th>Ucze≈Ñ</th><th>Opis</th>
          <th class="right">Godz.</th><th class="right">Stawka</th><th class="right">Kwota</th><th>Status</th><th></th>
        </tr>
      </thead>
      <tbody>
        {% for i in invoices %}
        <tr>
          <td>{{ i.number }}</td>
          <td>{{ i.issue_date }}</td>
          <td>{{ i.student.get_full_name|default:i.student.username }}</td>
          <td>{{ i.description }}</td>
          <td class="right mono">{{ i.hours|floatformat:2 }}</td>
          <td class="right mono">{{ i.rate_grosz|floatformat:-2|divisibleby:100 }}</td>
          <td class="right mono">{{ i.total_grosz|floatformat:-2|divisibleby:100 }}</td>
          <td>
            {% if i.payment.status == 'paid' %}<span class="status paid">paid</span>
            {% elif i.payment.status == 'pending' %}<span class="status pending">pending</span>
            {% else %}<span class="status failed">{{ i.payment.status }}</span>{% endif %}
          </td>
          <td><a class="btn btn-outline" href="{% url 'invoice_pdf' i.id %}">PDF</a></td>
        </tr>
        {% empty %}
        <tr><td colspan="9" style="text-align:center;color:#5b6777">Brak dokument√≥w w tym miesiƒÖcu.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Mobile -->
  <div class="tiles">
    {% for i in invoices %}
    <div class="card">
      <div class="row">
        <div class="nr">{{ i.number }}</div>
        <div class="{% if i.payment.status == 'paid' %}status paid{% elif i.payment.status == 'pending' %}status pending{% else %}status failed{% endif %}">
          {{ i.payment.status }}
        </div>
      </div>
      <div class="muted">{{ i.issue_date }} ‚Ä¢ {{ i.student.get_full_name|default:i.student.username }}</div>
      <div class="muted">{{ i.description }}</div>
      <div class="row">
        <div class="mono"><strong>{{ i.total_grosz|floatformat:-2|divisibleby:100 }}</strong></div>
        <a class="btn btn-outline" href="{% url 'invoice_pdf' i.id %}">PDF</a>
      </div>
    </div>
    {% empty %}
      <div class="muted">Brak dokument√≥w w tym miesiƒÖcu.</div>
    {% endfor %}
  </div>
</div>
</body>
</html>
